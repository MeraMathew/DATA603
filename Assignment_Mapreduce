import PyPDF2
from collections import defaultdict
import re
from spellchecker import SpellChecker

# Function to extract text from PDF
def extract_text_from_pdf(pdf_path, start_page, num_pages, output_file):
    with open(pdf_path, 'rb') as file:
        pdf_reader = PyPDF2.PdfReader(file)
        total_pages = len(pdf_reader.pages)
        
        extracted_text = ""
        for page_num in range(start_page, min(start_page + num_pages, total_pages)):
            page = pdf_reader.pages[page_num]
            extracted_text += page.extract_text()

        with open(output_file, 'w', encoding='utf-8') as output:
            output.write(extracted_text)

# Extract text for file1.txt (from pages 4941 to 4951)
pdf_path = "C:\\Users\\meera\\Desktop\\DATA 603\\HW\\Map_Reduce\\Harry_Potter_Half_Blood_Prince.pdf"  # PDF file path
start_page_file1 = 4941 - 1  # 1-indexed to 0-indexed
num_pages_file1 = 10
output_file1 = "file1.txt"
extract_text_from_pdf(pdf_path, start_page_file1, num_pages_file1, output_file1)

# Function to count word occurrences in a text file
def count_word_occurrences(file_name):
    word_count = defaultdict(int)

    with open(file_name, 'r', encoding='utf-8') as file:
        for line in file:
            words = re.findall(r'\b\w+\b', line.lower())
            for word in words:
                word_count[word] += 1

    return word_count

# Count occurrences in file1.txt
word_count_file1 = count_word_occurrences(output_file1)

# Print the word count for file1
print("Word count for file1:")
for word, count in word_count_file1.items():
    print(f"{word}: {count}")

# Write word counts to file2.txt for non-English word analysis
output_file2 = "file2.txt"
with open(output_file2, 'w', encoding='utf-8') as file2:
    for word, count in word_count_file1.items():
        file2.write(f"{word}: {count}\n")

# Extract text for file2.txt (from pages 100 to 110)
start_page_file2 = 100 - 1  # 1-indexed to 0-indexed
num_pages_file2 = 10
output_file2_text = "file2.txt"
extract_text_from_pdf(pdf_path, start_page_file2, num_pages_file2, output_file2_text)

# Function to count non-English words in a text file
def count_non_english_words(file_name):
    spell = SpellChecker()
    non_english_count = defaultdict(int)

    try:
        with open(file_name, 'r', encoding='utf-8') as file:
            for line in file:
                words = re.findall(r'\b\w+\b', line.lower())
                for word in words:
                    if word not in spell:  # If the word is not found in the dictionary
                        non_english_count[word] += 1

    except FileNotFoundError:
        print(f"Error: The file {file_name} was not found.")
        return non_english_count  # Return empty count

    return non_english_count

# Count non-English words in file2.txt
non_english_count_file2 = count_non_english_words(output_file2)

# Print the non-English word count for file2
print("Non-English word count for file2:")
for word, count in non_english_count_file2.items():
    print(f"{word}: {count}")

